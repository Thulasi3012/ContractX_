2025-11-25 13:42:34,645 - app.main - INFO - ================================================================================
2025-11-25 13:42:34,646 - app.main - INFO - Initializing ContractX Services
2025-11-25 13:42:34,647 - app.main - INFO - ================================================================================
2025-11-25 13:42:34,659 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 13:42:34,659 - app.services.text_llm_service - INFO - TextLLMService Initialized
2025-11-25 13:42:34,660 - app.services.text_llm_service - INFO - Model: gemini-2.0-flash-exp
2025-11-25 13:42:34,660 - app.services.text_llm_service - INFO - Request Delay: 2.0s
2025-11-25 13:42:34,661 - app.services.text_llm_service - INFO - Max Retries: 5
2025-11-25 13:42:34,661 - app.services.text_llm_service - INFO - Retry Delay: 60s
2025-11-25 13:42:34,661 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 13:42:34,661 - app.services.table_detection_service - INFO - ================================================================================
2025-11-25 13:42:34,661 - app.services.table_detection_service - INFO - Initializing TableDetectionService
2025-11-25 13:42:34,662 - app.services.table_detection_service - INFO - ================================================================================
2025-11-25 13:42:34,662 - app.services.table_detection_service - INFO - Loading model: microsoft/table-transformer-detection
2025-11-25 13:42:38,343 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (timm/resnet18.a1_in1k)
2025-11-25 13:42:38,632 - timm.models._hub - INFO - [timm/resnet18.a1_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-25 13:42:38,711 - timm.models._builder - INFO - Missing keys (fc.weight, fc.bias) discovered while loading pretrained weights. This is expected if model is being adapted.
2025-11-25 13:42:39,619 - app.services.table_detection_service - INFO - Device: cpu
2025-11-25 13:42:39,619 - app.services.table_detection_service - INFO - Confidence Threshold: 0.7
2025-11-25 13:42:39,620 - app.services.table_detection_service - INFO - ================================================================================
2025-11-25 13:42:39,621 - app.services.table_llm_service - INFO - ================================================================================
2025-11-25 13:42:39,621 - app.services.table_llm_service - INFO - TableLLMService Initialized
2025-11-25 13:42:39,622 - app.services.table_llm_service - INFO - Model: gemini-2.0-flash-exp
2025-11-25 13:42:39,622 - app.services.table_llm_service - INFO - Request Delay: 2.0s
2025-11-25 13:42:39,623 - app.services.table_llm_service - INFO - Max Retries: 5
2025-11-25 13:42:39,623 - app.services.table_llm_service - INFO - Retry Delay: 60s
2025-11-25 13:42:39,623 - app.services.table_llm_service - INFO - ================================================================================
2025-11-25 13:42:39,638 - app.main - INFO - ================================================================================
2025-11-25 13:43:41,266 - app.main - INFO - ================================================================================
2025-11-25 13:43:41,266 - app.main - INFO - NEW REQUEST: req_20251125_134341_265970
2025-11-25 13:43:41,267 - app.main - INFO - File: table test.pdf
2025-11-25 13:43:41,267 - app.main - INFO - Chunk Size: 5
2025-11-25 13:43:41,267 - app.main - INFO - Overlap: 1
2025-11-25 13:43:41,268 - app.main - INFO - ================================================================================
2025-11-25 13:43:41,268 - app.main - INFO - Step 1: Saving and validating file...
2025-11-25 13:43:41,328 - app.main - INFO - Step 2: Converting document to pages...
2025-11-25 13:43:41,426 - app.main - INFO - Step 3: Creating chunks...
2025-11-25 13:43:41,437 - app.main - INFO - Chunk Statistics: {'total_chunks': 3, 'total_pages': 12, 'avg_pages_per_chunk': 4.0, 'total_images': 0, 'chunks_info': [{'chunk_id': 1, 'page_range': '1-5', 'pages': 5, 'images': 0, 'text_length': 5136}, {'chunk_id': 2, 'page_range': '5-9', 'pages': 5, 'images': 0, 'text_length': 6312}, {'chunk_id': 3, 'page_range': '9-12', 'pages': 4, 'images': 0, 'text_length': 7005}]}
2025-11-25 13:43:41,438 - app.main - INFO - ================================================================================
2025-11-25 13:43:41,438 - app.main - INFO - Step 4: Processing Chunks with Text LLM and Table Detection
2025-11-25 13:43:41,438 - app.main - INFO - ================================================================================
2025-11-25 13:43:41,439 - app.main - INFO - 
================================================================================
2025-11-25 13:43:41,439 - app.main - INFO - Processing Chunk 1/3
2025-11-25 13:43:41,439 - app.main - INFO - ================================================================================
2025-11-25 13:43:41,440 - app.main - INFO - 4a: Text LLM Analysis...
2025-11-25 13:43:41,440 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 13:43:41,442 - app.services.text_llm_service - INFO - Processing Chunk 1 (Pages 1-5)
2025-11-25 13:43:41,442 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 13:43:41,444 - app.services.text_llm_service - INFO - Applying rate limit: waiting 2.0s before API call...
2025-11-25 13:43:43,446 - app.services.text_llm_service - INFO - Attempt 1/5 - Sending request to Gemini API
2025-11-25 13:43:43,933 - app.services.text_llm_service - ERROR - Error type: ResourceExhausted
2025-11-25 13:43:43,934 - app.services.text_llm_service - ERROR - Error message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash-exp
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash-exp
Please retry in 16.814117563s. [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_input_token_count"
  quota_id: "GenerateContentInputTokensPerModelPerMinute-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-2.0-flash-exp"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
}
violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerMinutePerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-2.0-flash-exp"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
}
, retry_delay {
  seconds: 16
}
]
2025-11-25 13:43:43,956 - app.services.text_llm_service - INFO - Exponential backoff: attempt 1 -> 120s delay
2025-11-25 13:43:43,957 - app.services.text_llm_service - WARNING - Pausing for 120s before retry...
2025-11-25 13:45:43,973 - app.services.text_llm_service - INFO - Attempt 2/5 - Sending request to Gemini API
2025-11-25 13:45:44,165 - app.services.text_llm_service - ERROR - Error type: ResourceExhausted
2025-11-25 13:45:44,166 - app.services.text_llm_service - ERROR - Error message: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash-exp
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash-exp
Please retry in 16.586171313s. [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerMinutePerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-2.0-flash-exp"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
}
violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_input_token_count"
  quota_id: "GenerateContentInputTokensPerModelPerMinute-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-2.0-flash-exp"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
}
, retry_delay {
  seconds: 16
}
]
2025-11-25 13:45:44,279 - app.services.text_llm_service - INFO - Exponential backoff: attempt 2 -> 240s delay
2025-11-25 13:45:44,284 - app.services.text_llm_service - WARNING - Pausing for 240s before retry...
