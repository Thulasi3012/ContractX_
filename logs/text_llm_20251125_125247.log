2025-11-25 12:53:13,107 - app.main - INFO - ================================================================================
2025-11-25 12:53:13,111 - app.main - INFO - Initializing ContractX Services
2025-11-25 12:53:13,117 - app.main - INFO - ================================================================================
2025-11-25 12:53:13,121 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 12:53:13,122 - app.services.text_llm_service - INFO - TextLLMService Initialized
2025-11-25 12:53:13,125 - app.services.text_llm_service - INFO - Model: gemini-2.0-flash-exp
2025-11-25 12:53:13,126 - app.services.text_llm_service - INFO - Request Delay: 2.0s
2025-11-25 12:53:13,126 - app.services.text_llm_service - INFO - Max Retries: 5
2025-11-25 12:53:13,127 - app.services.text_llm_service - INFO - Retry Delay: 60s
2025-11-25 12:53:13,127 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 12:53:13,128 - app.services.table_detection_service - INFO - ================================================================================
2025-11-25 12:53:13,131 - app.services.table_detection_service - INFO - Initializing TableDetectionService
2025-11-25 12:53:13,131 - app.services.table_detection_service - INFO - ================================================================================
2025-11-25 12:53:13,132 - app.services.table_detection_service - INFO - Loading model: microsoft/table-transformer-detection
2025-11-25 12:53:24,290 - timm.models._builder - INFO - Loading pretrained weights from Hugging Face hub (timm/resnet18.a1_in1k)
2025-11-25 12:53:24,614 - timm.models._hub - INFO - [timm/resnet18.a1_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-25 12:53:24,787 - timm.models._builder - INFO - Missing keys (fc.weight, fc.bias) discovered while loading pretrained weights. This is expected if model is being adapted.
2025-11-25 12:53:25,735 - app.services.table_detection_service - INFO - Device: cpu
2025-11-25 12:53:25,736 - app.services.table_detection_service - INFO - Confidence Threshold: 0.7
2025-11-25 12:53:25,737 - app.services.table_detection_service - INFO - ================================================================================
2025-11-25 12:53:25,737 - app.services.table_llm_service - INFO - ================================================================================
2025-11-25 12:53:25,741 - app.services.table_llm_service - INFO - TableLLMService Initialized
2025-11-25 12:53:25,742 - app.services.table_llm_service - INFO - Model: gemini-2.0-flash-exp
2025-11-25 12:53:25,743 - app.services.table_llm_service - INFO - Request Delay: 2.0s
2025-11-25 12:53:25,744 - app.services.table_llm_service - INFO - Max Retries: 5
2025-11-25 12:53:25,745 - app.services.table_llm_service - INFO - Retry Delay: 60s
2025-11-25 12:53:25,748 - app.services.table_llm_service - INFO - ================================================================================
2025-11-25 12:53:25,760 - app.main - INFO - ================================================================================
2025-11-25 13:39:17,769 - app.main - INFO - ================================================================================
2025-11-25 13:39:17,778 - app.main - INFO - NEW REQUEST: req_20251125_133917_767028
2025-11-25 13:39:17,779 - app.main - INFO - File: table test.pdf
2025-11-25 13:39:17,780 - app.main - INFO - Chunk Size: 5
2025-11-25 13:39:17,780 - app.main - INFO - Overlap: 1
2025-11-25 13:39:17,780 - app.main - INFO - ================================================================================
2025-11-25 13:39:17,780 - app.main - INFO - Step 1: Saving and validating file...
2025-11-25 13:39:18,172 - app.main - INFO - Step 2: Converting document to pages...
2025-11-25 13:39:18,762 - app.main - INFO - Step 3: Creating chunks...
2025-11-25 13:39:18,793 - app.main - INFO - Chunk Statistics: {'total_chunks': 3, 'total_pages': 12, 'avg_pages_per_chunk': 4.0, 'total_images': 0, 'chunks_info': [{'chunk_id': 1, 'page_range': '1-5', 'pages': 5, 'images': 0, 'text_length': 5136}, {'chunk_id': 2, 'page_range': '5-9', 'pages': 5, 'images': 0, 'text_length': 6312}, {'chunk_id': 3, 'page_range': '9-12', 'pages': 4, 'images': 0, 'text_length': 7005}]}
2025-11-25 13:39:18,794 - app.main - INFO - ================================================================================
2025-11-25 13:39:18,794 - app.main - INFO - Step 4: Processing Chunks with Text LLM and Table Detection
2025-11-25 13:39:18,795 - app.main - INFO - ================================================================================
2025-11-25 13:39:18,796 - app.main - INFO - 
================================================================================
2025-11-25 13:39:18,797 - app.main - INFO - Processing Chunk 1/3
2025-11-25 13:39:18,798 - app.main - INFO - ================================================================================
2025-11-25 13:39:18,800 - app.main - INFO - 4a: Text LLM Analysis...
2025-11-25 13:39:18,808 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 13:39:18,809 - app.services.text_llm_service - INFO - Processing Chunk 1 (Pages 1-5)
2025-11-25 13:39:18,810 - app.services.text_llm_service - INFO - ================================================================================
2025-11-25 13:39:18,810 - app.services.text_llm_service - INFO - Applying rate limit: waiting 2.0s before API call...
2025-11-25 13:39:20,815 - app.services.text_llm_service - INFO - Attempt 1/5 - Sending request to Gemini API
2025-11-25 13:39:22,343 - app.services.text_llm_service - ERROR - Error type: InvalidArgument
2025-11-25 13:39:22,344 - app.services.text_llm_service - ERROR - Error message: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-11-25 13:39:22,348 - app.services.text_llm_service - INFO - Exponential backoff: attempt 1 -> 60s delay
2025-11-25 13:39:22,349 - app.services.text_llm_service - WARNING - Retrying in 60s...
2025-11-25 13:40:22,366 - app.services.text_llm_service - INFO - Attempt 2/5 - Sending request to Gemini API
2025-11-25 13:40:22,546 - app.services.text_llm_service - ERROR - Error type: InvalidArgument
2025-11-25 13:40:22,549 - app.services.text_llm_service - ERROR - Error message: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-11-25 13:40:22,550 - app.services.text_llm_service - INFO - Exponential backoff: attempt 2 -> 120s delay
2025-11-25 13:40:22,550 - app.services.text_llm_service - WARNING - Retrying in 120s...
